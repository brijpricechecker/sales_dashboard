<!DOCTYPE html>
<html>
<head>
  <base target="_top">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet">
  <style>
    .dropdown-menu label {
      display: block;
      padding: 0.25rem 1.5rem;
      cursor: pointer;
    }
    .dropdown-menu input[type="checkbox"] {
      margin-right: 0.5rem;
    }
    .dropdown-toggle::after {
      margin-left: 0.5rem;
    }
  </style>
</head>
<body class="container py-4">
  <div class="row mb-3">
    <div class="col-md-3">
      <label for="startDate" class="form-label">Start Date</label>
      <input type="date" id="startDate" class="form-control">
    </div>
    <div class="col-md-3">
      <label for="endDate" class="form-label">End Date</label>
      <input type="date" id="endDate" class="form-control">
    </div>
    <div class="col-md-6">
      <label class="form-label">Suppliers</label>
      <div class="dropdown">
        <button class="btn btn-outline-secondary dropdown-toggle w-100" type="button" id="supplierDropdown" data-bs-toggle="dropdown" aria-expanded="false">
          Select Suppliers
        </button>
        <ul class="dropdown-menu w-100" aria-labelledby="supplierDropdown" id="supplierList"></ul>
      </div>
    </div>
  </div>
  <button class="btn btn-primary mb-3" onclick="fetchData()">Apply Filters</button>

  <div id="charts">
    <!-- Charts will render here -->
  </div>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script>
    let allSuppliers = [];

    function fetchData() {
      const startDate = document.getElementById('startDate').value;
      const endDate = document.getElementById('endDate').value;
      const selectedSuppliers = Array.from(document.querySelectorAll('#supplierList input:checked')).map(cb => cb.value);

      const params = new URLSearchParams({
        startDate,
        endDate,
        supplier: selectedSuppliers.join(',')
      });

      fetch(`https://script.google.com/macros/s/AKfycbxDh9XJzA3Zu38UFrOGtbm4cgbMeNEMazgv9PQWh1B0f0m6ZAjk1gY_3RBUVZLkPYhQ/exec?${params}`)
        .then(res => res.json())
        .then(renderData)
        .catch(err => console.error('Fetch error:', err));
    }

    function renderData(data) {
      allSuppliers = data.allSuppliers || [];
      renderSupplierDropdown();
      // Call your chart rendering functions here with data
    }

    function renderSupplierDropdown() {
      const list = document.getElementById('supplierList');
      list.innerHTML = '';
      allSuppliers.forEach(supplier => {
        const id = `chk-${supplier.replace(/\s+/g, '-')}`;
        const li = document.createElement('li');
        li.innerHTML = `<label><input type="checkbox" id="${id}" value="${supplier}"> ${supplier}</label>`;
        list.appendChild(li);
      });
    }

    window.onload = () => {
      const today = new Date();
      const priorDate = new Date();
      priorDate.setDate(today.getDate() - 30);

      document.getElementById('startDate').value = priorDate.toISOString().slice(0, 10);
      document.getElementById('endDate').value = today.toISOString().slice(0, 10);

      fetchData();
    }
  </script>
</body>
</html>























<!DOCTYPE html>
<html>
<head>
  <title>Inventory Dashboard</title>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 0;
      padding: 0;
      display: flex;
      flex-direction: column;
      height: 100vh;
    }
    .controls {
      padding: 10px;
      background: #f4f4f4;
    }
    .dashboard {
      display: flex;
      flex-wrap: wrap;
      flex: 1;
      overflow: hidden;
    }
    .chart-container {
      flex: 1 1 50%;
      height: 40%;
      box-sizing: border-box;
      padding: 10px;
    }
    .table-container {
      flex: 1 1 50%;
      height: 40%;
      overflow-y: auto;
      box-sizing: border-box;
      padding: 10px;
    }
    canvas {
      width: 100% !important;
      height: 100% !important;
    }
    table {
      width: 100%;
      border-collapse: collapse;
    }
    th, td {
      border: 1px solid #ddd;
      padding: 8px;
      text-align: left;
    }
    th {
      background-color: #f2f2f2;
    }
  </style>
</head>
<body>
  <div class="controls">
    Start Date: <input type="date" id="startDate">
    End Date: <input type="date" id="endDate">
    Suppliers: <select id="supplierFilter" multiple></select>
    <button onclick="loadData()">Apply Filters</button>
  </div>
  <div class="dashboard">
    <div class="chart-container">
      <canvas id="salesChart"></canvas>
    </div>
    <div class="chart-container">
      <canvas id="revenueBySupplierChart"></canvas>
    </div>
    <div class="table-container">
      <h3>Top Sales</h3>
      <table id="topSalesTable"></table>
    </div>
    <div class="table-container">
      <h3>Top Revenue</h3>
      <table id="topRevenueTable"></table>
    </div>
  </div>

  <script>
    async function loadData() {
      const startDate = document.getElementById('startDate').value;
      const endDate = document.getElementById('endDate').value;
      const supplierSelect = document.getElementById('supplierFilter');
      const selectedSuppliers = Array.from(supplierSelect.selectedOptions).map(o => o.value);

      const query = `?startDate=${startDate}&endDate=${endDate}&supplier=${selectedSuppliers.join(',')}`;
      const url = 'https://script.google.com/macros/s/AKfycbyNhFl8nWDfs7LQLWhhbV9-KUdENX-9aqT8W_jr4-zNEjBqeIKXwU9hWRuoTXaiHmJ8/exec' + query; // Replace with your actual Web App URL

      const res = await fetch(url);
      const data = await res.json();

      updateCharts(data);
      updateTables(data);
      updateSupplierOptions(data.allSuppliers, selectedSuppliers);
    }

    function updateCharts(data) {
      const salesCtx = document.getElementById('salesChart').getContext('2d');
      const revenueCtx = document.getElementById('revenueBySupplierChart').getContext('2d');

      if (window.salesChart) window.salesChart.destroy();
      if (window.revenueChart) window.revenueChart.destroy();

      const labels = Object.keys(data.timeline);
      const sales = labels.map(l => data.timeline[l].sales);
      const revenue = labels.map(l => data.timeline[l].revenue);

      window.salesChart = new Chart(salesCtx, {
        type: 'bar',
        data: {
          labels,
          datasets: [
            { label: 'Sales', data: sales, backgroundColor: 'skyblue' },
            { label: 'Revenue', data: revenue, backgroundColor: 'lightgreen' }
          ]
        }
      });

      const supplierLabels = data.revenueBySupplier.map(r => r.supplier);
      const supplierRevenue = data.revenueBySupplier.map(r => r.revenue);

      window.revenueChart = new Chart(revenueCtx, {
        type: 'pie',
        data: {
          labels: supplierLabels,
          datasets: [{
            label: 'Revenue by Supplier',
            data: supplierRevenue,
            backgroundColor: generateColors(supplierLabels.length)
          }]
        }
      });
    }

    function updateTables(data) {
      const topSalesTable = document.getElementById('topSalesTable');
      const topRevenueTable = document.getElementById('topRevenueTable');

      topSalesTable.innerHTML = '<tr><th>Item</th><th>Quantity</th><th>Sales</th></tr>' +
        data.topSales.map(item => `<tr><td>${item.name}</td><td>${item.quantity}</td><td>${item.sales}</td></tr>`).join('');

      topRevenueTable.innerHTML = '<tr><th>Item</th><th>Quantity</th><th>Revenue</th></tr>' +
        data.topRevenue.map(item => `<tr><td>${item.name}</td><td>${item.quantity}</td><td>${item.revenue}</td></tr>`).join('');
    }

    function updateSupplierOptions(allSuppliers, selected) {
      const select = document.getElementById('supplierFilter');
      select.innerHTML = allSuppliers.map(s => `<option value="${s}" ${selected.includes(s) ? 'selected' : ''}>${s}</option>`).join('');
    }

    function generateColors(count) {
      return Array.from({ length: count }, (_, i) => `hsl(${i * 360 / count}, 70%, 60%)`);
    }

    window.onload = loadData;
  </script>
</body>
</html>






<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8" />
<title>Inventory Dashboard</title>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<style>
body { font-family: Arial, sans-serif; background: #f5f5f5; padding: 20px; }
h2, h3 { color: #333; }
label, select, input { margin: 10px; }
.summary-boxes { display: flex; gap: 20px; margin-top: 20px; }
.box { background: white; padding: 15px; border: 1px solid #ccc; flex: 1; text-align: center; }
.charts-row { display: flex; gap: 20px; margin-top: 20px; }
canvas { background: #fff; border: 1px solid #ccc; padding: 10px; }
table { width: 100%; margin-top: 20px; border-collapse: collapse; background: white; }
th, td { padding: 8px; border: 1px solid #ccc; text-align: left; }
th { background-color: #eee; }
</style>
</head>
<body>

<h2>Inventory Dashboard</h2>

<label>Start Date: <input type="date" id="startDate"></label>
<label>End Date: <input type="date" id="endDate"></label>
<label>Supplier:
<select id="supplierFilter">
<option value="">All Suppliers</option>
</select>
</label>
<button onclick="loadDashboard()">Load Dashboard</button>

<div class="summary-boxes">
<div class="box" id="totalSalesBox">Total Sales: -</div>
<div class="box" id="totalPurchasesBox">Total Purchases: -</div>
<div class="box" id="totalRevenueBox">Total Revenue: -</div>
</div>

<h3>Revenue Distribution by Supplier</h3>
<canvas id="pieChart" width="400" height="250"></canvas>

<div class="charts-row">
<div style="flex:1">
<h3>Sales Over Time</h3>
<canvas id="salesChart" height="250"></canvas>
</div>
<div style="flex:1">
<h3>Purchases Over Time</h3>
<canvas id="purchaseChart" height="250"></canvas>
</div>
</div>

<h3>Top 10 Items by Sales</h3>
<table id="topSalesTable">
<thead><tr><th>Item</th><th>Quantity Sold</th></tr></thead>
<tbody></tbody>
</table>

<h3>Top 10 Items by Revenue</h3>
<table id="topRevenueTable">
<thead><tr><th>Item</th><th>Revenue</th></tr></thead>
<tbody></tbody>
</table>

<script>
const API_URL = "https://script.google.com/macros/s/AKfycbyNhFl8nWDfs7LQLWhhbV9-KUdENX-9aqT8W_jr4-zNEjBqeIKXwU9hWRuoTXaiHmJ8/exec"; // Replace with your web app URL

async function loadDashboard() {
const startDate = document.getElementById("startDate").value;
const endDate = document.getElementById("endDate").value;
const supplier = document.getElementById("supplierFilter").value;

const url = `${API_URL}?startDate=${startDate}&endDate=${endDate}&supplier=${encodeURIComponent(supplier)}`;
const res = await fetch(url);
const data = await res.json();

// Summary
document.getElementById("totalSalesBox").innerText = `Total Sales: ${data.totalSales}`;
document.getElementById("totalPurchasesBox").innerText = `Total Purchases: ${data.totalPurchases.toFixed(2)}`;
document.getElementById("totalRevenueBox").innerText = `Total Revenue: ${data.totalRevenue.toFixed(2)}`;

// Supplier dropdown
const dropdown = document.getElementById("supplierFilter");
dropdown.innerHTML = '<option value="">All Suppliers</option>';
data.allSuppliers.forEach(s => {
const opt = document.createElement("option");
opt.value = s;
opt.textContent = s;
dropdown.appendChild(opt);
});

// Pie Chart
renderPieChart(data.salesBySupplier);

// Top Sales & Revenue Tables
populateTable("topSalesTable", data.topSales, "sold");
populateTable("topRevenueTable", data.topRevenue, "revenue");

// Placeholder bar charts
renderBarChart("salesChart", "Sales Over Time", ["Jan", "Feb", "Mar"], [10, 20, 15]);
renderBarChart("purchaseChart", "Purchases Over Time", ["Jan", "Feb", "Mar"], [5, 10, 8]);
}

function renderPieChart(dataMap) {
const ctx = document.getElementById("pieChart").getContext("2d");
new Chart(ctx, {
type: "pie",
data: {
labels: Object.keys(dataMap),
datasets: [{
data: Object.values(dataMap),
backgroundColor: ['#FF6384', '#36A2EB', '#FFCE56', '#66BB6A', '#BA68C8', '#FFA726']
}]
}
});
}

function renderBarChart(id, label, labels, data) {
const ctx = document.getElementById(id).getContext("2d");
new Chart(ctx, {
type: "bar",
data: {
labels,
datasets: [{
label,
data,
backgroundColor: "#42A5F5"
}]
},
options: {
responsive: true,
scales: {
y: { beginAtZero: true }
}
}
});
}

function populateTable(tableId, data, field) {
const tbody = document.getElementById(tableId).querySelector("tbody");
tbody.innerHTML = "";
data.forEach(row => {
const tr = document.createElement("tr");
tr.innerHTML = `<td>${row.name}</td><td>${field === "revenue" ? row[field].toFixed(2) : row[field]}</td>`;
tbody.appendChild(tr);
});
}
</script>

</body>
</html>

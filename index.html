<!DOCTYPE html>
<html>
<head>
  <title>Inventory Dashboard</title>
  <script type="text/javascript" src="https://www.gstatic.com/charts/loader.js"></script>
  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 20px;
    }

    .filter-section {
      margin-bottom: 20px;
    }

    .multi-select {
      width: 200px;
      height: 100px;
    }

    .charts-container {
      display: flex;
      flex-wrap: wrap;
      gap: 20px;
    }

    .chart {
      flex: 1;
      min-width: 45%;
      min-height: 400px;
    }
  </style>
</head>
<body>
  <h2>Inventory Dashboard</h2>

  <div class="filter-section">
    <label>Start Date: <input type="date" id="startDate"></label>
    <label>End Date: <input type="date" id="endDate"></label>
    <br><br>
    <label>Suppliers:</label><br>
    <select id="supplierSelect" class="multi-select" multiple></select>
    <br><br>
    <button onclick="fetchData()">Apply Filters</button>
  </div>

  <div class="charts-container">
    <div class="chart" id="timelineChart"></div>
    <div class="chart" id="supplierChart"></div>
  </div>

  <script>
    google.charts.load('current', { packages: ['corechart'] });

    async function fetchData() {
      const startDate = document.getElementById('startDate').value;
      const endDate = document.getElementById('endDate').value;
      const supplierSelect = document.getElementById('supplierSelect');
      const selectedSuppliers = Array.from(supplierSelect.selectedOptions).map(opt => opt.value).join(',');

      const params = new URLSearchParams({
        startDate,
        endDate,
        supplier: selectedSuppliers
      });

      const response = await fetch(`https://script.google.com/macros/s/AKfycbxQ6X01gOsnohYlGqQ8dHDZDVmBEuAybaP7oqTr9HQX1HOE0apmaH9CAey9DqR4G10d/exec?${params}`);
      const data = await response.json();

      populateSuppliers(data.allSuppliers);
      drawTimelineChart(data.timeline);
      drawSupplierChart(data.revenueBySupplier);
    }

    function populateSuppliers(suppliers) {
      const select = document.getElementById('supplierSelect');
      if (select.options.length === 0) {
        suppliers.forEach(supplier => {
          const option = document.createElement('option');
          option.value = supplier;
          option.textContent = supplier;
          select.appendChild(option);
        });
      }
    }

    function drawTimelineChart(timeline) {
      const dataArray = [['Date', 'Sales', 'Revenue']];
      for (const date in timeline) {
        const { sales, revenue } = timeline[date];
        dataArray.push([date, parseFloat(sales), parseFloat(revenue)]);
      }

      const data = google.visualization.arrayToDataTable(dataArray);
      const options = {
        title: 'Sales and Revenue Over Time',
        curveType: 'function',
        legend: { position: 'bottom' }
      };

      const chart = new google.visualization.LineChart(document.getElementById('timelineChart'));
      chart.draw(data, options);
    }

    function drawSupplierChart(suppliers) {
      const dataArray = [['Supplier', 'Revenue']];
      suppliers.forEach(s => {
        dataArray.push([s.supplier, parseFloat(s.revenue)]);
      });

      const data = google.visualization.arrayToDataTable(dataArray);
      const options = {
        title: 'Revenue by Supplier',
        pieHole: 0.4
      };

      const chart = new google.visualization.PieChart(document.getElementById('supplierChart'));
      chart.draw(data, options);
    }

    // Set default dates and fetch initial data
    window.onload = () => {
      const today = new Date().toISOString().split('T')[0];
      document.getElementById('startDate').value = today;
      document.getElementById('endDate').value = today;
      fetchData();
    };
  </script>
</body>
</html>

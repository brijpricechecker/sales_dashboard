<!DOCTYPE html>
<html>
<head>
<title>Sales Dashboard</title>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<style>
body, html {
margin: 0;
font-family: Arial, sans-serif;
height: 100vh;
display: flex;
flex-direction: column;
}
#filters {
display: flex;
gap: 20px;
padding: 10px;
flex-wrap: wrap;
}
.kpi-boxes {
display: flex;
justify-content: space-around;
height: 10vh;
}
.kpi {
flex: 1;
text-align: center;
background: #f2f2f2;
margin: 5px;
padding: 10px;
border-radius: 5px;
}
#charts, #tables {
display: flex;
height: 40vh;
padding: 10px;
box-sizing: border-box;
}
.chart-container, .table-container {
flex: 1;
padding: 10px;
}
.table-container {
overflow-y: auto;
}
.dropdown {
position: relative;
}
.dropdown-toggle {
padding: 8px;
border: 1px solid #ccc;
cursor: pointer;
background: white;
}
.dropdown-menu {
display: none;
position: absolute;
background: white;
border: 1px solid #ccc;
max-height: 200px;
overflow-y: auto;
width: 250px;
z-index: 1000;
}
.dropdown.show .dropdown-menu {
display: block;
}
.tag-summary {
display: inline-block;
background: #e2e2e2;
padding: 4px 8px;
margin: 2px;
border-radius: 4px;
}
</style>
</head>
<body>

<div id="filters">
<label>
Start Date:
<input type="date" id="startDate">
</label>
<label>
End Date:
<input type="date" id="endDate">
</label>
<div class="dropdown" id="supplierDropdown">
<div class="dropdown-toggle" onclick="toggleDropdown()">Select Suppliers</div>
<div class="dropdown-menu">
<input type="text" placeholder="Search..." onkeyup="filterDropdown(this)">
<label><input type="checkbox" id="selectAll" onclick="toggleSelectAll(this)"> Select All</label>
<div id="supplierList"></div>
</div>
</div>
<div id="supplierTags"></div>
<button onclick="fetchData()">Apply</button>
</div>

<div class="kpi-boxes">
<div class="kpi"><h3 id="kpiSales">0</h3><p>Total Sales</p></div>
<div class="kpi"><h3 id="kpiPurchases">0</h3><p>Total Purchases</p></div>
<div class="kpi"><h3 id="kpiRevenue">0</h3><p>Total Revenue</p></div>
</div>

<div id="charts">
<div class="chart-container"><canvas id="monthlyChart"></canvas></div>
<div class="chart-container"><canvas id="timelineChart"></canvas></div>
</div>

<div id="tables">
<div class="table-container">
<h4>Top 10 Items by Quantity Sold</h4>
<table id="topSalesTable"></table>
</div>
<div class="table-container">
<h4>Top 10 Items by Revenue</h4>
<table id="topRevenueTable"></table>
</div>
<div class="table-container">
<h4>Revenue by Supplier</h4>
<table id="supplierTable"></table>
</div>
</div>

<script>
const SHEET_URL = 'https://script.google.com/macros/s/AKfycbyNhFl8nWDfs7LQLWhhbV9-KUdENX-9aqT8W_jr4-zNEjBqeIKXwU9hWRuoTXaiHmJ8/exec';

let monthlyChart, timelineChart;

function toggleDropdown() {
document.getElementById("supplierDropdown").classList.toggle("show");
}

function filterDropdown(input) {
const filter = input.value.toLowerCase();
const checkboxes = document.getElementById("supplierList").children;
Array.from(checkboxes).forEach(label => {
label.style.display = label.textContent.toLowerCase().includes(filter) ? "block" : "none";
});
}

function toggleSelectAll(box) {
const checkboxes = document.querySelectorAll("#supplierList input[type='checkbox']");
checkboxes.forEach(cb => cb.checked = box.checked);
updateTags();
}

function updateTags() {
const selected = Array.from(document.querySelectorAll("#supplierList input[type='checkbox']:checked"))
.map(cb => cb.value);
const tagContainer = document.getElementById("supplierTags");
tagContainer.innerHTML = selected.map(s => `<span class="tag-summary">${s}</span>`).join("");
}

function closeDropdowns(e) {
if (!document.getElementById("supplierDropdown").contains(e.target)) {
document.getElementById("supplierDropdown").classList.remove("show");
}
}
document.addEventListener("click", closeDropdowns);

function fetchData() {
const start = document.getElementById("startDate").value;
const end = document.getElementById("endDate").value;
const selected = Array.from(document.querySelectorAll("#supplierList input[type='checkbox']:checked"))
.map(cb => cb.value).join(",");

fetch(`${SHEET_URL}?startDate=${start}&endDate=${end}&supplier=${selected}`)
.then(res => res.json())
.then(updateDashboard);
}

function updateDashboard(data) {
document.getElementById("kpiSales").textContent = data.totals.sales;
document.getElementById("kpiPurchases").textContent = data.totals.purchases;
document.getElementById("kpiRevenue").textContent = data.totals.revenue;

// Monthly Chart
const months = Object.keys(data.monthly);
const sales = months.map(m => data.monthly[m].sales);
const purchases = months.map(m => data.monthly[m].purchases);
if (monthlyChart) monthlyChart.destroy();
monthlyChart = new Chart(document.getElementById("monthlyChart"), {
type: 'bar',
data: {
labels: months,
datasets: [
{ label: 'Sales', data: sales, backgroundColor: 'steelblue' },
{ label: 'Purchases', data: purchases, backgroundColor: 'orange' }
]
},
options: { responsive: true, scales: { x: { stacked: false }, y: { beginAtZero: true } } }
});

// Timeline Chart
const days = Object.keys(data.timeline);
const timelineSales = days.map(d => data.timeline[d].sales);
const timelineRevenue = days.map(d => data.timeline[d].revenue);
if (timelineChart) timelineChart.destroy();
timelineChart = new Chart(document.getElementById("timelineChart"), {
type: 'line',
data: {
labels: days,
datasets: [
{ label: 'Sales', data: timelineSales, borderColor: 'green', fill: false },
{ label: 'Revenue', data: timelineRevenue, borderColor: 'purple', fill: false }
]
}
});

buildTable("topSalesTable", data.topSales, ["name", "quantity", "sales"]);
buildTable("topRevenueTable", data.topRevenue, ["name", "quantity", "revenue"]);
buildTable("supplierTable", data.revenueBySupplier, ["supplier", "sales", "purchases", "revenue"]);
}

function buildTable(id, data, columns) {
const table = document.getElementById(id);
table.innerHTML = "<tr>" + columns.map(h => `<th>${h}</th>`).join("") + "</tr>" +
data.map(row => "<tr>" + columns.map(c => `<td>${row[c]}</td>`).join("") + "</tr>").join("");
}

function loadSuppliers() {
fetch(SHEET_URL).then(res => res.json()).then(data => {
const container = document.getElementById("supplierList");
container.innerHTML = "";
data.allSuppliers.forEach(s => {
const label = document.createElement("label");
label.innerHTML = `<input type="checkbox" value="${s}" onchange="updateTags()"> ${s}`;
container.appendChild(label);
});
});
}

loadSuppliers();
</script>
</body>
</html>

















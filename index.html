<!DOCTYPE html>
<html>
<head>
  <title>Inventory Dashboard</title>
  <script type="text/javascript" src="https://www.gstatic.com/charts/loader.js"></script>
  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 20px;
    }
    .filter-group {
      margin-bottom: 20px;
    }
    .checkbox-container {
      display: flex;
      flex-wrap: wrap;
      gap: 10px;
    }
    .checkbox-container label {
      white-space: nowrap;
    }
    .metrics {
      margin-bottom: 20px;
    }
    .chart {
      margin-bottom: 40px;
    }
  </style>
</head>
<body>
  <h1>Inventory Dashboard</h1>

  <div class="filter-group">
    <label for="startDate">Start Date:</label>
    <input type="date" id="startDate">
    <label for="endDate">End Date:</label>
    <input type="date" id="endDate">
  </div>

  <div class="filter-group">
    <strong>Suppliers:</strong>
    <div id="supplierCheckboxes" class="checkbox-container"></div>
  </div>

  <button onclick="fetchData()">Apply Filters</button>

  <div class="metrics">
    <p><strong>Total Sales:</strong> <span id="totalSales">0</span></p>
    <p><strong>Total Purchases:</strong> <span id="totalPurchases">0</span></p>
    <p><strong>Total Revenue:</strong> <span id="totalRevenue">0</span></p>
  </div>

  <div id="barChart" class="chart" style="width: 100%; height: 400px;"></div>
  <div id="pieChart" class="chart" style="width: 100%; height: 400px;"></div>

  <script>
    const API_URL = 'https://script.google.com/macros/s/AKfycbyNhFl8nWDfs7LQLWhhbV9-KUdENX-9aqT8W_jr4-zNEjBqeIKXwU9hWRuoTXaiHmJ8/exec';

    google.charts.load('current', { packages: ['corechart'] });

    window.onload = fetchData;

    function fetchData() {
      const startDate = document.getElementById('startDate').value;
      const endDate = document.getElementById('endDate').value;

      const selectedSuppliers = Array.from(document.querySelectorAll('#supplierCheckboxes input[type="checkbox"]:checked'))
        .map(cb => cb.value);

      const params = new URLSearchParams({
        startDate,
        endDate,
        supplier: selectedSuppliers.join(',')
      });

      fetch(`${API_URL}?${params.toString()}`)
        .then(res => res.json())
        .then(data => {
          updateMetrics(data.totals);
          renderBarChart(data.timeline);
          renderPieChart(data.revenueBySupplier);
          populateSupplierCheckboxes(data.allSuppliers, selectedSuppliers);
        })
        .catch(err => {
          console.error('Fetch error:', err);
          alert('Error fetching data');
        });
    }

    function updateMetrics(totals) {
      document.getElementById('totalSales').textContent = totals.sales;
      document.getElementById('totalPurchases').textContent = totals.purchases;
      document.getElementById('totalRevenue').textContent = totals.revenue;
    }

    function renderBarChart(timeline) {
      const data = new google.visualization.DataTable();
      data.addColumn('string', 'Date');
      data.addColumn('number', 'Revenue');

      Object.keys(timeline).forEach(date => {
        data.addRow([date, timeline[date].revenue]);
      });

      const options = {
        title: 'Revenue Over Time',
        hAxis: { title: 'Date' },
        vAxis: { title: 'Revenue' },
        legend: 'none'
      };

      const chart = new google.visualization.ColumnChart(document.getElementById('barChart'));
      chart.draw(data, options);
    }

    function renderPieChart(revenueBySupplier) {
      const data = new google.visualization.DataTable();
      data.addColumn('string', 'Supplier');
      data.addColumn('number', 'Sales');

      revenueBySupplier.forEach(s => {
        data.addRow([s.supplier, s.sales]);
      });

      const options = {
        title: 'Sales by Supplier',
        pieHole: 0.4
      };

      const chart = new google.visualization.PieChart(document.getElementById('pieChart'));
      chart.draw(data, options);
    }

    function populateSupplierCheckboxes(suppliers, selectedSuppliers = []) {
      const container = document.getElementById('supplierCheckboxes');
      container.innerHTML = '';
      suppliers.forEach(supplier => {
        const id = `supplier-${supplier.replace(/\s+/g, '-')}`;
        const checked = selectedSuppliers.includes(supplier) ? 'checked' : '';
        container.innerHTML += `
          <label for="${id}">
            <input type="checkbox" id="${id}" value="${supplier}" ${checked}>
            ${supplier}
          </label>
        `;
      });
    }
  </script>
</body>
</html>






















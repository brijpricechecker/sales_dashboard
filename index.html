<!DOCTYPE html>
<html>
<head>
<base target="_top">
<title>Sales Dashboard</title>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<style>
body {
font-family: Arial, sans-serif;
margin: 20px;
padding: 0;
}

.filters {
margin-bottom: 20px;
}

.summary {
display: flex;
flex-wrap: wrap;
gap: 15px;
margin-bottom: 30px;
}

.summary div {
flex: 1;
min-width: 150px;
padding: 15px;
border-radius: 8px;
color: white;
font-size: 18px;
font-weight: bold;
text-align: center;
}

.sales-box { background: #4CAF50; }
.purchases-box { background: #2196F3; }
.revenue-box { background: #FF9800; }

canvas {
max-width: 100%;
}

.charts {
display: flex;
flex-direction: column;
gap: 40px;
}

.chart-container {
width: 100%;
max-width: 100%;
}

table {
width: 100%;
border-collapse: collapse;
margin-top: 20px;
}

th, td {
border: 1px solid #ccc;
padding: 8px;
text-align: left;
}

th {
background: #f5f5f5;
}

@media (min-width: 768px) {
.charts {
flex-direction: row;
gap: 20px;
}

.chart-container {
flex: 1;
}
}
</style>
</head>
<body>
<h2>Sales Dashboard</h2>

<div class="filters">
<label>Start Date: <input type="date" id="startDate"></label>
<label>End Date: <input type="date" id="endDate"></label>
<label>Supplier: <select id="supplier"><option value="">All</option></select></label>
<button onclick="loadData()">Apply</button>
</div>

<div class="summary">
<div class="sales-box" id="totalSales">Sales: </div>
<div class="purchases-box" id="totalPurchases">Purchases: </div>
<div class="revenue-box" id="totalRevenue">Revenue: </div>
</div>

<div class="charts">
<div class="chart-container">
<canvas id="salesRevenueChart"></canvas>
</div>
</div>

<h3>Revenue by Supplier</h3>
<table id="revenueBySupplierTable">
<thead>
<tr><th>Supplier</th><th>Revenue</th><th>Total Sales</th><th>Total Purchases</th></tr>
</thead>
<tbody></tbody>
</table>

<h3>Top 10 Items by Quantity Sold</h3>
<table id="topSalesTable">
<thead>
<tr><th>Item</th><th>Quantity</th><th>Sales</th></tr>
</thead>
<tbody></tbody>
</table>

<h3>Top 10 Items by Revenue</h3>
<table id="topRevenueTable">
<thead>
<tr><th>Item</th><th>Quantity</th><th>Revenue</th></tr>
</thead>
<tbody></tbody>
</table>

<script>
async function loadData() {
const startDate = document.getElementById("startDate").value;
const endDate = document.getElementById("endDate").value;
const supplier = document.getElementById("supplier").value;
const url = `https://script.google.com/macros/s/AKfycbyNhFl8nWDfs7LQLWhhbV9-KUdENX-9aqT8W_jr4-zNEjBqeIKXwU9hWRuoTXaiHmJ8/exec`;

const res = await fetch(url);
const data = await res.json();

document.getElementById("totalSales").textContent = "Sales: " + data.totals.sales;
document.getElementById("totalPurchases").textContent = "Purchases: " + data.totals.purchases;
document.getElementById("totalRevenue").textContent = "Revenue: " + data.totals.revenue;

updateSalesRevenueChart(data.timeline);
updateTable("topSalesTable", data.topSales, ["name", "quantity", "sales"]);
updateTable("topRevenueTable", data.topRevenue, ["name", "quantity", "revenue"]);
updateRevenueBySupplierTable(data.revenueBySupplier);
populateSupplierDropdown(data.allSuppliers);
}

function updateSalesRevenueChart(timeline) {
const labels = Object.keys(timeline);
const sales = labels.map(date => timeline[date].sales);
const revenue = labels.map(date => timeline[date].revenue);

if (window.salesRevenueChart) {
window.salesRevenueChart.destroy();
}

const ctx = document.getElementById("salesRevenueChart").getContext("2d");
window.salesRevenueChart = new Chart(ctx, {
type: "line",
data: {
labels,
datasets: [
{
label: "Sales",
data: sales,
borderColor: "#4CAF50",
fill: false
},
{
label: "Revenue",
data: revenue,
borderColor: "#FF9800",
fill: false
}
]
},
options: {
responsive: true,
maintainAspectRatio: false,
scales: {
x: { title: { display: true, text: "Date" } },
y: { title: { display: true, text: "Amount" }, beginAtZero: true }
}
}
});
}

function updateTable(tableId, data, keys) {
const tbody = document.getElementById(tableId).querySelector("tbody");
tbody.innerHTML = "";
data.forEach(row => {
const tr = document.createElement("tr");
keys.forEach(key => {
const td = document.createElement("td");
td.textContent = typeof row[key] === "number" ? row[key].toLocaleString() : row[key];
tr.appendChild(td);
});
tbody.appendChild(tr);
});
}

function updateRevenueBySupplierTable(data) {
const tbody = document.getElementById("revenueBySupplierTable").querySelector("tbody");
tbody.innerHTML = "";
for (const supplier in data) {
const row = data[supplier];
const tr = document.createElement("tr");
[supplier, row.revenue, row.sales, row.purchases].forEach(val => {
const td = document.createElement("td");
td.textContent = typeof val === "number" ? val.toLocaleString() : val;
tr.appendChild(td);
});
tbody.appendChild(tr);
}
}

function populateSupplierDropdown(suppliers) {
const dropdown = document.getElementById("supplier");
dropdown.innerHTML = `<option value="">All</option>`;
suppliers.forEach(s => {
const opt = document.createElement("option");
opt.value = s;
opt.textContent = s;
dropdown.appendChild(opt);
});
}

loadData();
</script>
</body>
</html>






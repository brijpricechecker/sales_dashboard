<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Inventory Dashboard</title>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<style>
body {
font-family: Arial, sans-serif;
margin: 0;
padding: 10px;
}

.filters {
display: flex;
flex-wrap: wrap;
gap: 10px;
align-items: center;
}

.dropdown {
position: relative;
width: 250px;
}

.dropdown-btn {
width: 100%;
padding: 6px;
border: 1px solid #ccc;
background: #f9f9f9;
cursor: pointer;
}

.dropdown-content {
position: absolute;
background-color: white;
border: 1px solid #ccc;
z-index: 999;
max-height: 200px;
overflow-y: auto;
display: none;
width: 100%;
}

.dropdown-content input[type="checkbox"] {
margin-right: 6px;
}

.kpi-container {
display: flex;
justify-content: space-between;
margin: 15px 0;
height: 10vh;
}

.kpi {
flex: 1;
margin: 0 10px;
padding: 10px;
border-radius: 5px;
color: white;
font-weight: bold;
font-size: 1.2em;
text-align: center;
}

.kpi.sales { background-color: #4caf50; }
.kpi.purchases { background-color: #2196f3; }
.kpi.revenue { background-color: #f44336; }

.charts-container {
display: flex;
justify-content: space-between;
height: 40vh;
}

canvas {
width: 49% !important;
height: 100% !important;
}

.tables-container {
display: flex;
justify-content: space-between;
gap: 10px;
height: 40vh;
margin-top: 10px;
}

table {
border-collapse: collapse;
width: 100%;
background: #f9f9f9;
}

th, td {
border: 1px solid #ccc;
padding: 4px;
text-align: left;
}

th {
background-color: #e0e0e0;
}

.table-wrapper {
overflow-y: auto;
width: 33%;
}

.apply-btn {
padding: 6px 10px;
}
</style>
</head>
<body>

<div class="filters">
<input type="date" id="startDate">
<input type="date" id="endDate">

<div class="dropdown" id="supplierDropdown">
<div class="dropdown-btn" onclick="toggleDropdown()">Select Suppliers</div>
<div class="dropdown-content" id="supplierList"></div>
</div>

<button class="apply-btn" onclick="applyFilters()">Apply Filters</button>
</div>

<div class="kpi-container">
<div class="kpi sales" id="kpiSales">Total Sales: 0</div>
<div class="kpi purchases" id="kpiPurchases">Total Purchases: 0</div>
<div class="kpi revenue" id="kpiRevenue">Total Revenue: 0</div>
</div>

<div class="charts-container">
<canvas id="salesPurchasesChart"></canvas>
<canvas id="salesRevenueChart"></canvas>
</div>

<div class="tables-container">
<div class="table-wrapper">
<table id="topSalesTable">
<thead><tr><th>Item</th><th>Qty</th><th>Sales</th></tr></thead>
<tbody></tbody>
</table>
</div>
<div class="table-wrapper">
<table id="topRevenueTable">
<thead><tr><th>Item</th><th>Qty</th><th>Revenue</th></tr></thead>
<tbody></tbody>
</table>
</div>
<div class="table-wrapper">
<table id="supplierTable">
<thead><tr><th>Supplier</th><th>Revenue</th><th>Sales</th><th>Purchases</th></tr></thead>
<tbody></tbody>
</table>
</div>
</div>

<script>
let salesPurchasesChart, salesRevenueChart;

function toggleDropdown() {
const content = document.getElementById('supplierList');
content.style.display = content.style.display === 'block' ? 'none' : 'block';
}

function populateSupplierDropdown(suppliers) {
const list = document.getElementById('supplierList');
list.innerHTML = '<label><input type="checkbox" id="selectAll" onchange="toggleSelectAll(this)">Select All</label><br>';
suppliers.forEach(supplier => {
const label = document.createElement('label');
label.innerHTML = `<input type="checkbox" value="${supplier}"> ${supplier}`;
list.appendChild(label);
list.appendChild(document.createElement('br'));
});
}

function toggleSelectAll(source) {
const checkboxes = document.querySelectorAll('#supplierList input[type="checkbox"]:not(#selectAll)');
checkboxes.forEach(cb => cb.checked = source.checked);
}

function getSelectedSuppliers() {
return Array.from(document.querySelectorAll('#supplierList input[type="checkbox"]:not(#selectAll):checked'))
.map(cb => cb.value);
}

function applyFilters() {
const startDate = document.getElementById('startDate').value;
const endDate = document.getElementById('endDate').value;
const suppliers = getSelectedSuppliers();

google.script.run.withSuccessHandler(renderDashboard)
.getDashboardData(startDate, endDate, suppliers);
}

function renderDashboard(data) {
document.getElementById('kpiSales').innerText = `Total Sales: ${data.totalSales}`;
document.getElementById('kpiPurchases').innerText = `Total Purchases: ${data.totalPurchases.toFixed(2)}`;
document.getElementById('kpiRevenue').innerText = `Total Revenue: ${data.totalRevenue.toFixed(2)}`;

// Populate tables
const topSalesTable = document.querySelector('#topSalesTable tbody');
topSalesTable.innerHTML = '';
data.topSales.forEach(row => {
topSalesTable.innerHTML += `<tr><td>${row.name}</td><td>${row.qty}</td><td>${row.sales}</td></tr>`;
});

const topRevenueTable = document.querySelector('#topRevenueTable tbody');
topRevenueTable.innerHTML = '';
data.topRevenue.forEach(row => {
topRevenueTable.innerHTML += `<tr><td>${row.name}</td><td>${row.qty}</td><td>${row.revenue.toFixed(2)}</td></tr>`;
});

const supplierTable = document.querySelector('#supplierTable tbody');
supplierTable.innerHTML = '';
data.supplierData.forEach(row => {
supplierTable.innerHTML += `<tr><td>${row.supplier}</td><td>${row.revenue.toFixed(2)}</td><td>${row.sales}</td><td>${row.purchases.toFixed(2)}</td></tr>`;
});

// Draw Charts
drawCharts(data);
}

function drawCharts(data) {
const salesPurchaseData = {
labels: Object.keys(data.salesPurchaseMonthly).map(k => {
const d = new Date(k + '-01');
return d.toLocaleString('default', { month: 'short' });
}),
datasets: [
{
label: 'Sales',
data: Object.values(data.salesPurchaseMonthly).map(v => v.sales),
backgroundColor: 'rgba(54, 162, 235, 0.7)'
},
{
label: 'Purchases',
data: Object.values(data.salesPurchaseMonthly).map(v => v.purchases),
backgroundColor: 'rgba(255, 99, 132, 0.7)'
}
]
};

const salesRevenueData = {
labels: Object.keys(data.salesRevenueTimeline),
datasets: [
{
label: 'Sales',
data: Object.values(data.salesRevenueTimeline).map(v => v.sales),
borderColor: 'blue',
fill: false,
tension: 0.2
},
{
label: 'Revenue',
data: Object.values(data.salesRevenueTimeline).map(v => v.revenue),
borderColor: 'red',
fill: false,
tension: 0.2
}
]
};

if (salesPurchasesChart) salesPurchasesChart.destroy();
if (salesRevenueChart) salesRevenueChart.destroy();

const ctx1 = document.getElementById('salesPurchasesChart').getContext('2d');
salesPurchasesChart = new Chart(ctx1, {
type: 'bar',
data: salesPurchaseData,
options: {
responsive: true,
plugins: { legend: { position: 'top' } },
scales: { x: { title: { display: true, text: 'Month' } } }
}
});

const ctx2 = document.getElementById('salesRevenueChart').getContext('2d');
salesRevenueChart = new Chart(ctx2, {
type: 'line',
data: salesRevenueData,
options: {
responsive: true,
plugins: { legend: { position: 'top' } },
scales: { x: { title: { display: true, text: 'Date (MM-DD)' } } }
}
});
}

// Initialize todayâ€™s date
window.onload = function () {
const today = new Date().toISOString().substr(0, 10);
document.getElementById('endDate').value = today;
document.getElementById('startDate').value = new Date(new Date().setDate(new Date().getDate() - 30)).toISOString().substr(0, 10);

google.script.run.withSuccessHandler(populateSupplierDropdown).getDashboardData('', '', []);
applyFilters();
};
</script>
</body>
</html>













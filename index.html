<!DOCTYPE html>
<html>
<head>
<base target="_top">
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<style>
body {
font-family: Arial, sans-serif;
padding: 20px;
margin: 0;
background: #f4f4f4;
}
h1 {
text-align: center;
}
.summary {
display: flex;
justify-content: space-around;
flex-wrap: wrap;
margin-bottom: 20px;
}
.summary-box {
background-color: #fff;
padding: 15px;
border-radius: 8px;
width: 30%;
text-align: center;
font-weight: bold;
box-shadow: 0 2px 4px rgba(0,0,0,0.1);
margin: 10px 0;
}
.summary-box.sales { background-color: #d1ecf1; }
.summary-box.purchases { background-color: #d4edda; }
.summary-box.revenue { background-color: #fff3cd; }

.filters {
display: flex;
justify-content: center;
gap: 10px;
margin-bottom: 20px;
flex-wrap: wrap;
}

canvas {
max-width: 100%;
}

.table-container {
overflow-x: auto;
margin-top: 20px;
}

table {
width: 100%;
border-collapse: collapse;
margin-bottom: 30px;
background-color: #fff;
}

th, td {
padding: 8px 12px;
border: 1px solid #ccc;
text-align: left;
}

th {
background-color: #eee;
}

@media screen and (max-width: 768px) {
.summary-box {
width: 100%;
}
}
</style>
</head>
<body>
<h1>Sales Dashboard</h1>

<div class="filters">
<label>Start Date: <input type="date" id="startDate"></label>
<label>End Date: <input type="date" id="endDate"></label>
<label>Supplier: <select id="supplierSelect"><option value="">All</option></select></label>
<button onclick="loadDashboard()">Apply</button>
</div>

<div class="summary">
<div class="summary-box sales">Total Sales: <span id="totalSales">0</span></div>
<div class="summary-box purchases">Total Purchases: <span id="totalPurchases">0</span></div>
<div class="summary-box revenue">Total Revenue: <span id="totalRevenue">0</span></div>
</div>

<canvas id="lineChart"></canvas>

<div class="table-container">
<h3>Top 10 Items by Quantity Sold</h3>
<table>
<thead>
<tr><th>Item</th><th>Quantity</th><th>Sales</th></tr>
</thead>
<tbody id="topSalesTable"></tbody>
</table>
</div>

<div class="table-container">
<h3>Top 10 Items by Revenue</h3>
<table>
<thead>
<tr><th>Item</th><th>Quantity</th><th>Revenue</th></tr>
</thead>
<tbody id="topRevenueTable"></tbody>
</table>
</div>

<div class="table-container">
<h3>Revenue by Supplier</h3>
<table>
<thead>
<tr><th>Supplier</th><th>Revenue</th><th>Sales</th><th>Purchases</th></tr>
</thead>
<tbody id="supplierTable"></tbody>
</table>
</div>

<script>
const API_URL = 'https://script.google.com/macros/s/AKfycbyNhFl8nWDfs7LQLWhhbV9-KUdENX-9aqT8W_jr4-zNEjBqeIKXwU9hWRuoTXaiHmJ8/exec'; // If deployed, replace with full deployed web app URL

async function loadDashboard() {
const startDate = document.getElementById('startDate').value;
const endDate = document.getElementById('endDate').value;
const supplier = document.getElementById('supplierSelect').value;

const params = new URLSearchParams({ startDate, endDate, selectedSupplier: supplier });
const res = await fetch(`${API_URL}?action=getDashboardData&${params}`);
const data = await res.json();

document.getElementById('totalSales').innerText = formatNumber(data.totalSales);
document.getElementById('totalPurchases').innerText = formatNumber(data.totalPurchases);
document.getElementById('totalRevenue').innerText = formatNumber(data.totalRevenue);

renderLineChart(data.salesRevenueOverTime);
renderTable('topSalesTable', data.topSalesItems, ['item', 'quantity', 'sales']);
renderTable('topRevenueTable', data.topRevenueItems, ['item', 'quantity', 'revenue']);
renderTable('supplierTable', data.supplierTable, ['supplier', 'revenue', 'sales', 'purchases']);
}

function formatNumber(num) {
return Number(num).toLocaleString(undefined, { minimumFractionDigits: 2, maximumFractionDigits: 2 });
}

function renderTable(tableId, data, keys) {
const tbody = document.getElementById(tableId);
tbody.innerHTML = '';
data.forEach(row => {
const tr = document.createElement('tr');
keys.forEach(k => {
const td = document.createElement('td');
td.innerText = typeof row[k] === 'number' ? formatNumber(row[k]) : row[k];
tr.appendChild(td);
});
tbody.appendChild(tr);
});
}

function renderLineChart(data) {
const ctx = document.getElementById('lineChart').getContext('2d');
if (window.lineChartInstance) window.lineChartInstance.destroy();

const labels = data.map(d => d.date);
const salesData = data.map(d => d.sales);
const revenueData = data.map(d => d.revenue);

window.lineChartInstance = new Chart(ctx, {
type: 'line',
data: {
labels,
datasets: [
{
label: 'Sales',
data: salesData,
borderColor: 'blue',
fill: false,
},
{
label: 'Revenue',
data: revenueData,
borderColor: 'green',
fill: false,
}
]
},
options: {
responsive: true,
plugins: {
legend: { position: 'top' },
title: { display: true, text: 'Sales and Revenue Over Time' }
},
scales: {
y: {
beginAtZero: true
}
}
}
});
}

async function initSupplierDropdown() {
const res = await fetch(`${API_URL}?action=getDashboardData&startDate=2000-01-01&endDate=2100-01-01`);
const data = await res.json();
const select = document.getElementById('supplierSelect');
data.suppliers.forEach(supplier => {
const opt = document.createElement('option');
opt.value = supplier;
opt.text = supplier;
select.appendChild(opt);
});
}

window.onload = () => {
const today = new Date().toISOString().split('T')[0];
document.getElementById('startDate').value = today;
document.getElementById('endDate').value = today;
initSupplierDropdown().then(loadDashboard);
};
</script>
</body>
</html>







<!DOCTYPE html>
<html>
<head>
<base target="_top" />
<title>Sales Dashboard</title>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<style>
body {
font-family: Arial, sans-serif;
margin: 20px;
}

.summary-boxes {
display: flex;
flex-wrap: wrap;
gap: 15px;
margin-bottom: 20px;
}

.summary-box {
flex: 1 1 30%;
padding: 15px;
background-color: #f5f5f5;
border-radius: 8px;
text-align: center;
font-weight: bold;
}

.summary-sales {
background-color: #d1e7dd;
}

.summary-purchases {
background-color: #f8d7da;
}

.summary-revenue {
background-color: #cff4fc;
}

.filters {
margin-bottom: 20px;
}

.filters label {
margin-right: 10px;
}

.charts {
display: flex;
flex-wrap: wrap;
gap: 20px;
margin-bottom: 20px;
}

.chart-container {
flex: 1 1 100%;
min-width: 300px;
height: 300px;
}

.tables {
display: flex;
flex-wrap: wrap;
gap: 20px;
}

.table-container {
flex: 1 1 45%;
overflow-x: auto;
}

table {
width: 100%;
border-collapse: collapse;
margin-top: 10px;
}

th,
td {
border: 1px solid #ddd;
padding: 8px;
font-size: 14px;
}

th {
background-color: #f2f2f2;
font-weight: bold;
}

@media screen and (max-width: 768px) {
.charts,
.tables {
flex-direction: column;
}

.chart-container,
.table-container {
flex: 1 1 100%;
}
}
</style>
</head>

<body>
<h1>Sales Dashboard</h1>

<div class="filters">
<label>Start Date: <input type="date" id="startDate" /></label>
<label>End Date: <input type="date" id="endDate" /></label>
<label>
Supplier:
<select id="supplierFilter">
<option value="">All</option>
</select>
</label>
<button onclick="loadDashboard()">Apply</button>
</div>

<div class="summary-boxes">
<div class="summary-box summary-sales" id="totalSales">Total Sales: </div>
<div class="summary-box summary-purchases" id="totalPurchases">Total Purchases: </div>
<div class="summary-box summary-revenue" id="totalRevenue">Total Revenue: </div>
</div>

<div class="charts">
<div class="chart-container">
<canvas id="salesRevenueChart"></canvas>
</div>
</div>

<div class="tables">
<div class="table-container">
<h3>Top 10 Items by Quantity Sold</h3>
<table id="topSalesTable">
<thead>
<tr>
<th>Item</th>
<th>Quantity</th>
<th>Sales</th>
</tr>
</thead>
<tbody></tbody>
</table>
</div>

<div class="table-container">
<h3>Top 10 Items by Revenue</h3>
<table id="topRevenueTable">
<thead>
<tr>
<th>Item</th>
<th>Quantity</th>
<th>Revenue</th>
</tr>
</thead>
<tbody></tbody>
</table>
</div>
</div>

<div style="margin-top: 30px">
<h3>Revenue by Supplier</h3>
<table id="supplierRevenueTable">
<thead>
<tr>
<th>Supplier</th>
<th>Revenue</th>
<th>Total Sales</th>
<th>Total Purchases</th>
</tr>
</thead>
<tbody></tbody>
</table>
</div>

<script>
const API_URL = 'https://script.google.com/macros/s/AKfycbyNhFl8nWDfs7LQLWhhbV9-KUdENX-9aqT8W_jr4-zNEjBqeIKXwU9hWRuoTXaiHmJ8/exec'; // Replace with your actual Web App URL

async function loadDashboard() {
const startDate = document.getElementById('startDate').value;
const endDate = document.getElementById('endDate').value;
const supplier = document.getElementById('supplierFilter').value;

const response = await fetch(
`${API_URL}?startDate=${startDate}&endDate=${endDate}&supplier=${supplier}`
);
const data = await response.json();

document.getElementById('totalSales').textContent = 'Total Sales: ' + data.totalSales;
document.getElementById('totalPurchases').textContent = 'Total Purchases: ' + data.totalPurchases;
document.getElementById('totalRevenue').textContent = 'Total Revenue: ' + data.totalRevenue;

updateSalesRevenueChart(data.salesRevenueOverTime);
populateTable('topSalesTable', data.topSales, ['item', 'quantity', 'sales']);
populateTable('topRevenueTable', data.topRevenue, ['item', 'quantity', 'revenue']);
populateTable('supplierRevenueTable', data.revenueBySupplier, ['supplier', 'revenue', 'totalSales', 'totalPurchases']);
}

function populateTable(tableId, data, keys) {
const tbody = document.getElementById(tableId).querySelector('tbody');
tbody.innerHTML = '';
data.forEach(row => {
const tr = document.createElement('tr');
keys.forEach(key => {
const td = document.createElement('td');
td.textContent = row[key];
tr.appendChild(td);
});
tbody.appendChild(tr);
});
}

let salesRevenueChart;

function updateSalesRevenueChart(data) {
const ctx = document.getElementById('salesRevenueChart').getContext('2d');
const labels = data.map(item => item.date);
const salesData = data.map(item => item.sales);
const revenueData = data.map(item => item.revenue);

if (salesRevenueChart) salesRevenueChart.destroy();

salesRevenueChart = new Chart(ctx, {
type: 'line',
data: {
labels,
datasets: [
{
label: 'Sales',
data: salesData,
borderColor: 'green',
fill: false,
},
{
label: 'Revenue',
data: revenueData,
borderColor: 'blue',
fill: false,
},
],
},
options: {
responsive: true,
maintainAspectRatio: false,
scales: {
x: {
title: {
display: true,
text: 'Date (MM/DD)',
},
},
y: {
title: {
display: true,
text: 'Amount',
},
},
},
},
});
}

async function populateSupplierDropdown() {
const response = await fetch(`${API_URL}?getSuppliers=true`);
const data = await response.json();
const dropdown = document.getElementById('supplierFilter');
dropdown.innerHTML = '<option value="">All</option>';
data.suppliers.forEach(supplier => {
const option = document.createElement('option');
option.value = supplier;
option.textContent = supplier;
dropdown.appendChild(option);
});
}

window.onload = function () {
populateSupplierDropdown();
loadDashboard();
};
</script>
</body>
</html>







<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Inventory Dashboard</title>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<style>
body { font-family: Arial, sans-serif; margin: 20px; }
.filters, .kpis, .charts, .tables { margin-bottom: 30px; }
.kpis div { display: inline-block; margin-right: 20px; font-size: 1.2em; }
canvas { max-width: 100%; }
table { width: 100%; border-collapse: collapse; margin-top: 10px; }
th, td { border: 1px solid #ccc; padding: 8px; text-align: left; }
</style>
</head>
<body>

<h1>Inventory Dashboard</h1>

<div class="filters">
<label>View:
<select id="view">
<option value="monthly">Monthly</option>
<option value="weekly">Weekly</option>
<option value="daily">Daily</option>
</select>
</label>

<label>Start Date:
<input type="date" id="startDate">
</label>

<label>End Date:
<input type="date" id="endDate">
</label>

<label>Suppliers:
<select id="suppliers" multiple size="4" style="min-width: 200px;"></select>
</label>

<button onclick="loadData()">Apply</button>
</div>

<div class="kpis">
<div>Sales: <span id="kpi-sales">0</span></div>
<div>Purchases: <span id="kpi-purchases">0</span></div>
<div>Revenue: <span id="kpi-revenue">0</span></div>
</div>

<div class="charts">
<canvas id="timelineChart"></canvas>
<canvas id="supplierChart"></canvas>
</div>

<div class="tables">
<h3>Top Sales</h3>
<table id="topSalesTable"><thead><tr><th>Item</th><th>Qty</th><th>Sales</th></tr></thead><tbody></tbody></table>

<h3>Top Revenue</h3>
<table id="topRevenueTable"><thead><tr><th>Item</th><th>Qty</th><th>Revenue</th></tr></thead><tbody></tbody></table>
</div>

<script>
const SHEET_URL = "https://script.google.com/macros/s/AKfycbxQ6X01gOsnohYlGqQ8dHDZDVmBEuAybaP7oqTr9HQX1HOE0apmaH9CAey9DqR4G10d/exec";

let timelineChart, supplierChart;

function formatCurrency(num) {
return "â‚±" + num.toLocaleString(undefined, { maximumFractionDigits: 2 });
}

function loadData() {
const view = document.getElementById("view").value;
const startDate = document.getElementById("startDate").value;
const endDate = document.getElementById("endDate").value;
const suppliersSelect = document.getElementById("suppliers");
const selectedSuppliers = Array.from(suppliersSelect.selectedOptions).map(opt => opt.value);
const params = new URLSearchParams({
view,
...(startDate && { startDate }),
...(endDate && { endDate }),
...(selectedSuppliers.length ? { supplier: selectedSuppliers.join(",") } : {})
});

fetch(`${SHEET_URL}?${params}`)
.then(res => res.json())
.then(data => {
// Update KPIs
document.getElementById("kpi-sales").textContent = formatCurrency(data.totals.sales);
document.getElementById("kpi-purchases").textContent = formatCurrency(data.totals.purchases);
document.getElementById("kpi-revenue").textContent = formatCurrency(data.totals.revenue);

// Timeline chart
const labels = Object.keys(data.timeline);
const sales = labels.map(k => data.timeline[k].sales);
const purchases = labels.map(k => data.timeline[k].purchases);
const revenue = labels.map(k => data.timeline[k].revenue);

if (timelineChart) timelineChart.destroy();
timelineChart = new Chart(document.getElementById("timelineChart"), {
type: 'line',
data: {
labels,
datasets: [
{ label: "Sales", data: sales, borderColor: "blue", fill: false },
{ label: "Purchases", data: purchases, borderColor: "orange", fill: false },
{ label: "Revenue", data: revenue, borderColor: "green", fill: false }
]
},
options: { responsive: true, plugins: { legend: { position: 'top' } } }
});

// Supplier revenue chart
const supplierLabels = data.revenueBySupplier.map(s => s.supplier);
const supplierRevenue = data.revenueBySupplier.map(s => s.revenue);

if (supplierChart) supplierChart.destroy();
supplierChart = new Chart(document.getElementById("supplierChart"), {
type: 'bar',
data: {
labels: supplierLabels,
datasets: [{ label: "Revenue", data: supplierRevenue, backgroundColor: "purple" }]
},
options: { responsive: true, plugins: { legend: { display: false } } }
});

// Top sales table
const salesTable = document.querySelector("#topSalesTable tbody");
salesTable.innerHTML = "";
data.topSales.forEach(item => {
salesTable.innerHTML += `<tr><td>${item.name}</td><td>${item.quantity}</td><td>${formatCurrency(item.sales)}</td></tr>`;
});

// Top revenue table
const revenueTable = document.querySelector("#topRevenueTable tbody");
revenueTable.innerHTML = "";
data.topRevenue.forEach(item => {
revenueTable.innerHTML += `<tr><td>${item.name}</td><td>${item.quantity}</td><td>${formatCurrency(item.revenue)}</td></tr>`;
});

// Populate suppliers dropdown
const suppliers = data.allSuppliers;
const supplierDropdown = document.getElementById("suppliers");
if (supplierDropdown.options.length === 0) {
suppliers.forEach(s => {
const opt = document.createElement("option");
opt.value = s;
opt.textContent = s;
supplierDropdown.appendChild(opt);
});
}
})
.catch(err => console.error("Error loading data:", err));
}

window.onload = loadData;
</script>

</body>
</html>



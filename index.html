<!DOCTYPE html>
<html>
<head>
<title>Inventory Dashboard</title>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<style>
body {
font-family: Arial, sans-serif;
margin: 10px;
}
.kpis {
display: flex;
justify-content: space-around;
margin-bottom: 10px;
}
.kpi {
background: #f4f4f4;
padding: 10px;
border-radius: 8px;
flex: 1;
text-align: center;
margin: 5px;
}
.charts, .tables {
display: flex;
flex-wrap: wrap;
height: 40vh;
gap: 10px;
}
.chart-container, .table-container {
flex: 1;
min-width: 300px;
background: #fff;
padding: 10px;
border: 1px solid #ddd;
overflow: auto;
}
.table-container table {
width: 100%;
border-collapse: collapse;
}
.table-container th, .table-container td {
border: 1px solid #ccc;
padding: 4px;
text-align: left;
}
.filters {
display: flex;
align-items: center;
justify-content: space-between;
margin: 10px 0;
flex-wrap: wrap;
}
.dropdown {
position: relative;
display: inline-block;
}
.dropdown-content {
display: none;
position: absolute;
background: #f9f9f9;
min-width: 250px;
max-height: 300px;
overflow-y: auto;
box-shadow: 0 8px 16px rgba(0,0,0,0.2);
z-index: 10;
padding: 10px;
}
.dropdown:hover .dropdown-content {
display: block;
}
.dropdown-content input[type="checkbox"] {
margin-right: 6px;
}
.dropdown-content input[type="text"] {
width: 90%;
margin-bottom: 5px;
padding: 4px;
}
@media screen and (max-width: 768px) {
.charts, .tables {
flex-direction: column;
height: auto;
}
}
</style>
</head>
<body>
<h2>Inventory Dashboard</h2>

<div class="filters">
<div class="dropdown">
<button>Select Suppliers</button>
<div class="dropdown-content">
<input type="text" id="searchInput" placeholder="Search suppliers...">
<div><input type="checkbox" id="selectAll"> <label for="selectAll"><strong>Select All</strong></label></div>
<div id="supplierCheckboxes"></div>
</div>
</div>
<div>
<label>From: <input type="date" id="startDate"></label>
<label>To: <input type="date" id="endDate"></label>
<button onclick="loadData()">Apply</button>
</div>
</div>

<div class="kpis">
<div class="kpi"><h3>Total Sales</h3><div id="totalSales">0</div></div>
<div class="kpi"><h3>Total Revenue</h3><div id="totalRevenue">0</div></div>
<div class="kpi"><h3>Total Purchases</h3><div id="totalPurchases">0</div></div>
</div>

<div class="charts">
<div class="chart-container">
<canvas id="lineChart"></canvas>
</div>
<div class="chart-container">
<canvas id="barChart"></canvas>
</div>
</div>

<div class="tables">
<div class="table-container" id="table1"></div>
<div class="table-container" id="table2"></div>
<div class="table-container" id="table3"></div>
</div>

<script>
const endpoint = 'https://script.google.com/macros/s/AKfycbwA2KDBI3mwXx8mn6n5ICO5tVAexOCRxHGr2IwXnWwvifmHY6-lhX4wB-6NDsQ_ppg/exec';

let allSuppliers = [];

async function loadData() {
const start = document.getElementById('startDate').value;
const end = document.getElementById('endDate').value;
const selected = Array.from(document.querySelectorAll('#supplierCheckboxes input:checked')).map(cb => cb.value);
const params = new URLSearchParams({
startDate: start,
endDate: end,
supplier: selected.join(',')
});
const res = await fetch(`${endpoint}?${params}`);
const data = await res.json();
if (data.error) return alert(data.error);

document.getElementById('totalSales').textContent = data.totals.sales.toFixed(2);
document.getElementById('totalRevenue').textContent = data.totals.revenue.toFixed(2);
document.getElementById('totalPurchases').textContent = data.totals.purchases.toFixed(2);

renderLineChart(data.timeline);
renderBarChart(data.timeline);
renderTable('table1', 'Top 10 Items by Quantity Sold', data.topSales, ['name', 'quantity']);
renderTable('table2', 'Top 10 Items by Revenue', data.topRevenue, ['name', 'revenue']);
renderTable('table3', 'Revenue by Supplier', data.revenueBySupplier, ['supplier', 'sales', 'revenue', 'purchases']);

populateSupplierFilter(data.allSuppliers);
}

function renderTable(containerId, title, rows, keys) {
let html = `<h4>${title}</h4><table><tr>${keys.map(k => `<th>${k}</th>`).join('')}</tr>`;
for (const row of rows) {
html += `<tr>${keys.map(k => `<td>${row[k]}</td>`).join('')}</tr>`;
}
html += '</table>';
document.getElementById(containerId).innerHTML = html;
}

let lineChart, barChart;

function renderLineChart(data) {
const labels = Object.keys(data).sort();
const sales = labels.map(k => data[k].sales);
const revenue = labels.map(k => data[k].revenue);

if (lineChart) lineChart.destroy();
lineChart = new Chart(document.getElementById('lineChart'), {
type: 'line',
data: {
labels,
datasets: [
{ label: 'Sales', data: sales, borderColor: 'blue', fill: false },
{ label: 'Revenue', data: revenue, borderColor: 'green', fill: false }
]
}
});
}

function renderBarChart(data) {
const labels = Object.keys(data).sort();
const purchases = labels.map(k => data[k].purchases);

if (barChart) barChart.destroy();
barChart = new Chart(document.getElementById('barChart'), {
type: 'bar',
data: {
labels,
datasets: [{ label: 'Purchases', data: purchases, backgroundColor: 'orange' }]
}
});
}

function populateSupplierFilter(suppliers) {
if (allSuppliers.length) return; // Only populate once
allSuppliers = suppliers;
const container = document.getElementById('supplierCheckboxes');
container.innerHTML = '';
suppliers.forEach(s => {
const id = 'cb-' + s.replace(/\s+/g, '-');
container.innerHTML += `<div><input type="checkbox" id="${id}" value="${s}" checked> <label for="${id}">${s}</label></div>`;
});

document.getElementById('selectAll').addEventListener('change', function() {
const all = container.querySelectorAll('input[type="checkbox"]');
all.forEach(cb => cb.checked = this.checked);
});

document.getElementById('searchInput').addEventListener('input', function() {
const val = this.value.toLowerCase();
const divs = container.querySelectorAll('div');
divs.forEach(d => {
const label = d.textContent.toLowerCase();
d.style.display = label.includes(val) ? '' : 'none';
});
});
}

loadData();
</script>
</body>
</html>














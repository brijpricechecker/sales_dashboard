<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8" />
<title>Inventory Dashboard</title>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<style>
body { font-family: Arial, sans-serif; padding: 20px; background: #f4f4f4; }
h2 { color: #333; }
label, select, input { margin: 10px; }
canvas { background: #fff; border: 1px solid #ccc; margin-top: 20px; }
table { width: 100%; border-collapse: collapse; margin-top: 20px; background: white; }
th, td { border: 1px solid #ccc; padding: 8px; text-align: left; }
th { background-color: #eee; }
</style>
</head>
<body>
<h2>Inventory Dashboard</h2>
<label>Start Date: <input type="date" id="startDate"></label>
<label>End Date: <input type="date" id="endDate"></label>
<label>Supplier:
<select id="supplierFilter">
<option value="">All Suppliers</option>
</select>
</label>
<button onclick="loadDashboard()">Load Dashboard</button>

<h3>Sales Distribution by Supplier</h3>
<canvas id="pieChart" width="400" height="200"></canvas>

<h3>Sales, Purchases, Revenue Over Time</h3>
<canvas id="lineChart" width="600" height="300"></canvas>

<h3>Top 10 Items by Quantity Sold</h3>
<table id="topSalesTable">
<thead><tr><th>Item</th><th>Quantity Sold</th></tr></thead>
<tbody></tbody>
</table>

<h3>Top 10 Items by Revenue</h3>
<table id="topRevenueTable">
<thead><tr><th>Item</th><th>Revenue</th></tr></thead>
<tbody></tbody>
</table>

<script>
const API_URL = "https://script.google.com/macros/s/AKfycbyNhFl8nWDfs7LQLWhhbV9-KUdENX-9aqT8W_jr4-zNEjBqeIKXwU9hWRuoTXaiHmJ8/exec"; // Replace with actual

async function loadDashboard() {
const startDate = document.getElementById("startDate").value;
const endDate = document.getElementById("endDate").value;
const supplier = document.getElementById("supplierFilter").value;
const url = `${API_URL}?startDate=${startDate}&endDate=${endDate}&supplier=${encodeURIComponent(supplier)}`;
const res = await fetch(url);
const data = await res.json();

renderPieChart(data.salesBySupplier);
renderLineChart(data.timeline);
populateTable("topSalesTable", data.topSales, "quantity");
populateTable("topRevenueTable", data.topRevenue, "revenue");
populateSupplierFilter(data.allSuppliers);
}

function renderPieChart(data) {
const ctx = document.getElementById("pieChart").getContext("2d");
new Chart(ctx, {
type: "pie",
data: {
labels: Object.keys(data),
datasets: [{
data: Object.values(data),
backgroundColor: ['#FF6384', '#36A2EB', '#FFCE56', '#8AFF9C', '#FFA07A']
}]
}
});
}

function renderLineChart(timeline) {
const ctx = document.getElementById("lineChart").getContext("2d");
new Chart(ctx, {
type: "line",
data: {
labels: timeline.map(e => e.date),
datasets: [
{ label: "Sales", data: timeline.map(e => e.sales), borderColor: "#36A2EB", fill: false },
{ label: "Purchases", data: timeline.map(e => e.purchases), borderColor: "#FF6384", fill: false },
{ label: "Revenue", data: timeline.map(e => e.revenue), borderColor: "#8AFF9C", fill: false }
]
}
});
}

function populateTable(id, data, field) {
const tbody = document.getElementById(id).querySelector("tbody");
tbody.innerHTML = "";
data.forEach(row => {
const tr = document.createElement("tr");
tr.innerHTML = `<td>${row.item}</td><td>${row[field]}</td>`;
tbody.appendChild(tr);
});
}

function populateSupplierFilter(suppliers) {
const select = document.getElementById("supplierFilter");
if (select.options.length > 1) return; // already populated
suppliers.forEach(supplier => {
const option = document.createElement("option");
option.value = supplier;
option.textContent = supplier;
select.appendChild(option);
});
}
</script>
</body>
</html>

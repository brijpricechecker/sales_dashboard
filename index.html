<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Inventory Dashboard</title>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<style>
body {
margin: 0;
font-family: Arial, sans-serif;
}

.kpi-container {
display: flex;
justify-content: space-around;
align-items: center;
height: 10vh;
background: #f0f0f0;
}

.kpi-box {
background: white;
border: 1px solid #ccc;
padding: 10px;
text-align: center;
width: 30%;
box-shadow: 0 2px 4px rgba(0,0,0,0.1);
}

.filters {
display: flex;
justify-content: space-between;
align-items: center;
padding: 10px;
background: #fafafa;
border-bottom: 1px solid #ddd;
flex-wrap: wrap;
}

.dropdown {
position: relative;
width: 250px;
}

.dropdown-btn {
border: 1px solid #ccc;
padding: 8px;
background: white;
cursor: pointer;
}

.dropdown-content {
display: none;
position: absolute;
background: white;
border: 1px solid #ccc;
max-height: 200px;
overflow-y: auto;
z-index: 10;
width: 100%;
}

.dropdown-content input[type="text"] {
width: 95%;
margin: 5px;
padding: 5px;
}

.dropdown-content label {
display: block;
padding: 4px 8px;
}

.chart-container {
display: flex;
height: 40vh;
}

.chart-box {
width: 50%;
padding: 10px;
}

.table-container {
display: flex;
height: 40vh;
overflow-x: auto;
}

table {
border-collapse: collapse;
width: 100%;
min-width: 300px;
background: white;
}

th, td {
border: 1px solid #ccc;
padding: 6px;
text-align: left;
}

th {
background: #f8f8f8;
}

.table-box {
flex: 1;
overflow-y: auto;
padding: 10px;
}

@media (max-width: 768px) {
.chart-container, .table-container {
flex-direction: column;
height: auto;
}
.chart-box, .table-box {
width: 100%;
}
}
</style>
</head>
<body>

<div class="kpi-container">
<div class="kpi-box" id="salesBox">Sales: $0.00</div>
<div class="kpi-box" id="purchasesBox">Purchases: $0.00</div>
<div class="kpi-box" id="revenueBox">Revenue: $0.00</div>
</div>

<div class="filters">
<div>
Start Date: <input type="date" id="startDate">
End Date: <input type="date" id="endDate">
</div>
<div class="dropdown" id="supplierDropdown">
<div class="dropdown-btn" onclick="toggleDropdown()">Select Suppliers</div>
<div class="dropdown-content" id="supplierList">
<input type="text" placeholder="Search..." onkeyup="filterSuppliers(this)">
</div>
</div>
</div>

<div class="chart-container">
<div class="chart-box">
<canvas id="timelineChart"></canvas>
</div>
<div class="chart-box">
<canvas id="monthlyChart"></canvas>
</div>
</div>

<div class="table-container">
<div class="table-box">
<h3>Top 10 by Quantity Sold</h3>
<table id="topSalesTable"><thead></thead><tbody></tbody></table>
</div>
<div class="table-box">
<h3>Top 10 by Revenue</h3>
<table id="topRevenueTable"><thead></thead><tbody></tbody></table>
</div>
<div class="table-box">
<h3>Revenue by Supplier</h3>
<table id="revenueBySupplierTable"><thead></thead><tbody></tbody></table>
</div>
</div>

<script>
const scriptURL = 'https://script.google.com/macros/s/AKfycbyNhFl8nWDfs7LQLWhhbV9-KUdENX-9aqT8W_jr4-zNEjBqeIKXwU9hWRuoTXaiHmJ8/exec'; // Replace with your Web App URL
let supplierOptions = [];

function toggleDropdown() {
const content = document.getElementById("supplierList");
content.style.display = content.style.display === "block" ? "none" : "block";
}

document.addEventListener("click", function(event) {
if (!event.target.closest("#supplierDropdown")) {
document.getElementById("supplierList").style.display = "none";
}
});

function fetchData() {
const startDate = document.getElementById("startDate").value;
const endDate = document.getElementById("endDate").value;
const selectedSuppliers = [...document.querySelectorAll('#supplierList input[type="checkbox"]:checked')]
.filter(el => el.value !== 'all')
.map(el => el.value)
.join(",");

const url = `${scriptURL}?startDate=${startDate}&endDate=${endDate}&supplier=${selectedSuppliers}`;
fetch(url)
.then(res => res.json())
.then(renderData);
}

function renderData(data) {
document.getElementById("salesBox").innerText = `Sales: $${data.totals.sales}`;
document.getElementById("purchasesBox").innerText = `Purchases: $${data.totals.purchases}`;
document.getElementById("revenueBox").innerText = `Revenue: $${data.totals.revenue}`;

updateChart("timelineChart", "Sales vs Revenue", data.timeline, ['sales', 'revenue'], 'bar');
updateChart("monthlyChart", "Monthly Sales vs Purchases", data.monthly, ['sales', 'purchases'], 'bar');

updateTable("topSalesTable", data.topSales, ["name", "quantity", "sales"]);
updateTable("topRevenueTable", data.topRevenue, ["name", "quantity", "revenue"]);
updateTable("revenueBySupplierTable", data.revenueBySupplier, ["supplier", "revenue", "sales", "purchases"]);

if (!supplierOptions.length) renderSupplierDropdown(data.allSuppliers);
}

function updateChart(id, label, dataset, keys, type) {
const ctx = document.getElementById(id).getContext("2d");
const labels = Object.keys(dataset);
const dataSets = keys.map((k, i) => ({
label: k.charAt(0).toUpperCase() + k.slice(1),
backgroundColor: i === 0 ? "#4CAF50" : "#2196F3",
data: labels.map(d => dataset[d][k] || 0)
}));

if (window[id]) window[id].destroy();
window[id] = new Chart(ctx, {
type,
data: {
labels,
datasets: dataSets
},
options: {
responsive: true,
plugins: {
legend: { position: 'top' },
title: { display: true, text: label }
}
}
});
}

function updateTable(id, data, columns) {
const table = document.getElementById(id);
const thead = table.querySelector("thead");
const tbody = table.querySelector("tbody");
thead.innerHTML = "<tr>" + columns.map(c => `<th>${c}</th>`).join("") + "</tr>";
tbody.innerHTML = data.map(row =>
"<tr>" + columns.map(c => `<td>${row[c]}</td>`).join("") + "</tr>"
).join("");
}

function renderSupplierDropdown(suppliers) {
supplierOptions = suppliers;
const list = document.getElementById("supplierList");
list.innerHTML += `<input type="text" placeholder="Search..." onkeyup="filterSuppliers(this)">`;
list.innerHTML += `<label><input type="checkbox" id="selectAll" checked onchange="toggleAll(this)"> Select All</label>`;
suppliers.forEach(supplier => {
list.innerHTML += `<label><input type="checkbox" value="${supplier}" checked> ${supplier}</label>`;
});
}

function toggleAll(source) {
document.querySelectorAll('#supplierList input[type="checkbox"]').forEach(checkbox => {
if (checkbox !== source) checkbox.checked = source.checked;
});
fetchData();
}

function filterSuppliers(input) {
const filter = input.value.toLowerCase();
const labels = document.querySelectorAll('#supplierList label');
labels.forEach(label => {
if (label.innerText.toLowerCase().includes(filter)) {
label.style.display = '';
} else {
label.style.display = 'none';
}
});
}

document.getElementById("startDate").addEventListener("change", fetchData);
document.getElementById("endDate").addEventListener("change", fetchData);
document.getElementById("supplierList").addEventListener("change", fetchData);

window.onload = () => {
const today = new Date().toISOString().split('T')[0];
document.getElementById("startDate").value = today;
document.getElementById("endDate").value = today;
fetchData();
};
</script>
</body>
</html>













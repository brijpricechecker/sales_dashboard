<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Inventory Dashboard</title>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<style>
body {
font-family: Arial, sans-serif;
margin: 0;
padding: 0;
}
.kpi-container, .charts-row, .tables-row {
display: flex;
flex-wrap: wrap;
justify-content: space-between;
padding: 10px;
}
.kpi-box {
flex: 1;
margin: 10px;
padding: 20px;
background: #f0f0f0;
text-align: center;
min-width: 120px;
}
canvas {
width: 100% !important;
height: 100% !important;
}
.chart-container, .table-container {
width: 49%;
height: 40vh;
overflow-y: auto;
margin: 5px 0;
}
table {
width: 100%;
border-collapse: collapse;
font-size: 0.9em;
}
table, th, td {
border: 1px solid #ccc;
}
th, td {
padding: 6px;
text-align: left;
}
#supplierFilter {
position: relative;
width: 100%;
margin: 10px;
}
.dropdown-btn {
width: 100%;
padding: 10px;
border: 1px solid #ccc;
background: white;
text-align: left;
cursor: pointer;
}
.dropdown-content {
position: absolute;
width: 100%;
background: white;
border: 1px solid #ccc;
max-height: 200px;
overflow-y: auto;
z-index: 10;
display: none;
}
.dropdown-content input[type="checkbox"] {
margin-right: 6px;
}
.tag-container {
display: flex;
flex-wrap: wrap;
gap: 4px;
padding: 6px;
}
.tag {
background: #007bff;
color: white;
border-radius: 12px;
padding: 2px 8px;
font-size: 12px;
}
@media (max-width: 768px) {
.chart-container, .table-container {
width: 100%;
}
}
</style>
</head>
<body>

<div id="supplierFilter">
<div class="dropdown-btn" onclick="toggleDropdown()">Filter by Supplier</div>
<div class="dropdown-content" id="dropdownContent">
<input type="text" id="searchBox" placeholder="Search..." onkeyup="filterSuppliers()">
<div><label><input type="checkbox" id="selectAll" onchange="toggleSelectAll(this)"> Select All</label></div>
<div id="supplierCheckboxes"></div>
</div>
<div class="tag-container" id="selectedTags"></div>
</div>

<div class="kpi-container" id="kpiContainer"></div>

<div class="charts-row">
<div class="chart-container"><canvas id="salesChart"></canvas></div>
<div class="chart-container"><canvas id="monthlyChart"></canvas></div>
</div>

<div class="tables-row">
<div class="table-container" id="topSalesTableContainer"></div>
<div class="table-container" id="topRevenueTableContainer"></div>
<div class="table-container" id="revenueBySupplierTableContainer"></div>
</div>

<script>
let allSuppliers = [];
let selectedSuppliers = [];

async function fetchData() {
const params = selectedSuppliers.length > 0 ? `?supplier=${selectedSuppliers.join(',')}` : '';
const response = await fetch(`https://script.google.com/macros/s/AKfycbwA2KDBI3mwXx8mn6n5ICO5tVAexOCRxHGr2IwXnWwvifmHY6-lhX4wB-6NDsQ_ppg/exec`);
const data = await response.json();
renderDashboard(data);
}

function renderDashboard(data) {
renderKPIs(data.totals);
renderDropdown(data.allSuppliers);
renderChart("salesChart", data.timeline, "sales", "Revenue");
renderChart("monthlyChart", data.monthly, "sales", "Purchases");
renderTable("topSalesTableContainer", "Top 10 by Quantity Sold", data.topSales, ["name", "quantity", "sales"]);
renderTable("topRevenueTableContainer", "Top 10 by Revenue", data.topRevenue, ["name", "quantity", "revenue"]);
renderTable("revenueBySupplierTableContainer", "Revenue by Supplier", data.revenueBySupplier, ["supplier", "revenue", "sales", "purchases"]);
}

function renderKPIs(totals) {
const kpiHTML = `
<div class="kpi-box"><h3>Sales</h3><p>${totals.sales}</p></div>
<div class="kpi-box"><h3>Purchases</h3><p>${totals.purchases}</p></div>
<div class="kpi-box"><h3>Revenue</h3><p>${totals.revenue}</p></div>
`;
document.getElementById("kpiContainer").innerHTML = kpiHTML;
}

function renderChart(id, data, field1, field2) {
const labels = Object.keys(data).sort();
const values1 = labels.map(k => data[k][field1]);
const values2 = labels.map(k => data[k][field2.toLowerCase()]);
new Chart(document.getElementById(id), {
type: "line",
data: {
labels,
datasets: [
{ label: field1, data: values1, borderColor: "blue", fill: false },
{ label: field2, data: values2, borderColor: "green", fill: false }
]
},
options: { responsive: true }
});
}

function renderTable(containerId, title, data, columns) {
let html = `<h4>${title}</h4><table><thead><tr>${columns.map(c => `<th>${c}</th>`).join("")}</tr></thead><tbody>`;
data.forEach(row => {
html += `<tr>${columns.map(c => `<td>${row[c]}</td>`).join("")}</tr>`;
});
html += `</tbody></table>`;
document.getElementById(containerId).innerHTML = html;
}

function renderDropdown(suppliers) {
allSuppliers = suppliers;
const checkboxContainer = document.getElementById("supplierCheckboxes");
checkboxContainer.innerHTML = allSuppliers.map(s => `
<label><input type="checkbox" value="${s}" onchange="onSupplierChange()"> ${s}</label><br>
`).join("");
}

function onSupplierChange() {
const checkboxes = document.querySelectorAll("#supplierCheckboxes input[type='checkbox']");
selectedSuppliers = Array.from(checkboxes).filter(cb => cb.checked).map(cb => cb.value);
document.getElementById("selectAll").checked = selectedSuppliers.length === allSuppliers.length;
updateTags();
fetchData();
}

function toggleSelectAll(selectAll) {
const checkboxes = document.querySelectorAll("#supplierCheckboxes input[type='checkbox']");
checkboxes.forEach(cb => cb.checked = selectAll.checked);
onSupplierChange();
}

function filterSuppliers() {
const search = document.getElementById("searchBox").value.toLowerCase();
const labels = document.querySelectorAll("#supplierCheckboxes label");
labels.forEach(label => {
label.style.display = label.textContent.toLowerCase().includes(search) ? "" : "none";
});
}

function toggleDropdown() {
const dropdown = document.getElementById("dropdownContent");
dropdown.style.display = dropdown.style.display === "block" ? "none" : "block";
}

document.addEventListener("click", (e) => {
const dropdown = document.getElementById("dropdownContent");
const btn = document.querySelector(".dropdown-btn");
if (!dropdown.contains(e.target) && !btn.contains(e.target)) {
dropdown.style.display = "none";
}
});

function updateTags() {
const container = document.getElementById("selectedTags");
container.innerHTML = selectedSuppliers.map(s => `<span class="tag">${s}</span>`).join("");
}

window.onload = fetchData;
</script>
</body>
</html>
















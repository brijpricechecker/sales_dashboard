<!DOCTYPE html>
<html>
<head>
<title>Inventory Dashboard</title>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<style>
body { font-family: Arial, sans-serif; padding: 20px; }
.filter { margin-bottom: 20px; }
canvas { max-width: 100%; }
table { width: 100%; border-collapse: collapse; margin-top: 20px; }
th, td { padding: 8px; border: 1px solid #ccc; text-align: left; }
th { background-color: #f4f4f4; }
</style>
</head>
<body>
<h1>Inventory Dashboard</h1>

<div class="filter">
<label>Start Date: <input type="date" id="startDate" /></label>
<label>End Date: <input type="date" id="endDate" /></label>
<label>Supplier: <input type="text" id="supplier" placeholder="Optional" /></label>
<button onclick="loadDashboard()">Load Dashboard</button>
</div>

<h2>Sales Performance</h2>
<canvas id="salesChart" height="100"></canvas>

<h2>Top 10 Selling Items</h2>
<table id="topSalesTable">
<thead>
<tr>
<th>Barcode</th>
<th>Item Name</th>
<th>Supplier</th>
<th>Qty Sold</th>
</tr>
</thead>
<tbody></tbody>
</table>

<script>
const API_URL = 'https://script.google.com/macros/s/AKfycbyNhFl8nWDfs7LQLWhhbV9-KUdENX-9aqT8W_jr4-zNEjBqeIKXwU9hWRuoTXaiHmJ8/exec'; // Replace with your Apps Script web app URL

async function loadDashboard() {
const start = document.getElementById("startDate").value;
const end = document.getElementById("endDate").value;
const supplier = document.getElementById("supplier").value;

const query = `?startDate=${encodeURIComponent(start)}&endDate=${encodeURIComponent(end)}&supplier=${encodeURIComponent(supplier)}`;

try {
const response = await fetch(`${API_URL}/exec${query}`);
const data = await response.json();

renderSalesChart(data);
renderTopSalesTable(data);
} catch (error) {
console.error("Error loading dashboard:", error);
alert("Failed to load dashboard. Check console for errors.");
}
}

function renderSalesChart(data) {
const labels = data.map(d => d.name);
const sales = data.map(d => d.sold);

const ctx = document.getElementById("salesChart").getContext("2d");
if (window.salesChart) window.salesChart.destroy();

window.salesChart = new Chart(ctx, {
type: "bar",
data: {
labels,
datasets: [{
label: "Qty Sold",
data: sales,
backgroundColor: "#4CAF50"
}]
},
options: {
responsive: true,
scales: {
y: { beginAtZero: true }
}
}
});
}

function renderTopSalesTable(data) {
const tbody = document.querySelector("#topSalesTable tbody");
tbody.innerHTML = "";

const top = [...data].sort((a, b) => b.sold - a.sold).slice(0, 10);

top.forEach(item => {
const row = `<tr>
<td>${item.barcode}</td>
<td>${item.name}</td>
<td>${item.supplier}</td>
<td>${item.sold}</td>
</tr>`;
tbody.insertAdjacentHTML("beforeend", row);
});
}
</script>
</body>
</html>
